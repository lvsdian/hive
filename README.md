### Hive

- facebook开源的**海量结构化日志**的数据统计，是基于Hadoop的一个**数据仓库工具**，可以将**结构化的数据映射为一张表**，并提供**类SQL**查询功能。**本质：将HQL转化为MapReduce程序**。

  ![](img\1.png)

  1. hive处理的数据存储在hdfs上
  2. hive分析数据底层的实现是MapReduce
  3. 执行程序运行在Yarn上

- 优缺点

  - 优点
    1. 操作类似SQL，简单、易上手
    2. 避免写MapReduce，节约成本
    3. 执行延迟较高，适用于实时性要求不高的场合
    4. 优势在于处理大批量数据，处理小数据没有优势，因为执行延迟较高
    5. 支持自定义函数
  - 缺点
    1. HQL表达能力有限，迭代式算法无法表达
    2. 数据挖掘方面不擅长
    3. 效率低，自动生成的MapReduce作业通常情况下不够智能化
    4. 调优较困难，粒度粗

- 架构

  ![](img\2.png)

  - CLI：用户接口
  - 元数据(Meta store)：包括表名、表所属的数据库(默认是default)、表的拥有者、列/分区字段、表的类型(是否外部表)、表的数据所在目录等：**默认存储在自带的derby数据库中，推荐使用MySQL存储Metastore**。
  - 驱动器
    - 解析器：将 SQL 字符串转换成抽象语法树 AST，这一步一般都用第 三方工具库完成，比如 antlr；对 AST 进行语法分析，比如表是否存在、字段是否存在、SQL 语义是否有误。
    - 编译器：将 AST 编译生成逻辑执行计划。
    - 优化器：对逻辑执行计划进行优化。 
    - 执行器：把逻辑执行计划转换成可以运行的物理计划。对于 Hive 来 说，就是 MR/Spark。

  ![](img\3.png)

